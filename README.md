# Latte language compiler

[Latte](https://www.mimuw.edu.pl/~ben/Zajecia/Mrj2023/Latte/) is an imperative, statically-typed language. The compiler generates [LLVM](https://en.wikipedia.org/wiki/LLVM) (Low Level Virtual Machine) code and LLVM bitcode, which can be executed directly with `lli`. It compiles code and applies several optimizations so that the generated bitcode is efficient.

## Example

```
# test.bc file

string hello() {
    return "Hello World!";
}

int square(int n) {
    return n * n;
}

int factorial(int n) {
    int answer;

    answer = 1;
    while (n > 0) {
        answer = answer * n;
        n = n - 1;
    }

    return answer;
}

int main() {
    int n = readInt();
    printString(hello());
    printInt(square(n));
    printInt(factorial(n));

    return 0;
}

```
```
> echo "6" | lli test.bc
Hello World!
36
720
```

## Implemented Features

* All basic instructions described [here](https://www.mimuw.edu.pl/~ben/Zajecia/Mrj2023/Latte/).
* Block partitioning and [SSA](https://en.wikipedia.org/wiki/Static_single-assignment_form) usage (no `load` or `alloca` instructions).
* [CSE](https://en.wikipedia.org/wiki/Common_subexpression_elimination) - computing each subexpression at most once. For instance, in the code `n = x + y; m = y + x`, the addition operation would be executed only once, since both expressions involve the same operands.
* Parsing constant expressions of types `Int` and `Bool`.
* Skipping unreachable code (after the `return` keyword).
* Induction variables - replacing costly operations (as multiplication) in loops by addition.

## Usage

* `make` creates the executable file `latc_llvm` in the root directory.
* `./latc_llvm program.lat` generates `program.ll` (LLVM code) and `program.bc` (LLVM bitcode which can be run with `lli`).
* `make clean` works in the standard way.

## Project Structure

* The `src/Main.hs` file is responsible for calling the appropriate functions on the input file.
* The `src/Grammar` directory contains files generated by running BNFC on the `Latte.cf` grammar.
* The `src/Frontend` directory is responsible for semantic analysis, parsing constant expressions of type `Int` and `Bool`, and removing unreachable code.
* The `src/Backend` directory is responsible for generating LLVM code by transforming the AST into a correct final program.
* The `lib` directory contains the `runtime.c` file, which defines library functions written in C and is automatically converted to a `.ll` file.

## Assumptions

Below are the solutions to issues that were not specified in the task description:
* Function arguments are not treated as variables initialized within the function block.
* Statements after the `return` keyword are not type-checked (since they are unreachable).
* Small support for characters such as "\n" in the `printString` function - these will be correctly converted to newline characters in LLVM code.
* If the `readString()` function reads a single EOF character, the read string will be considered empty.
* The range of `Int` literals is as in C ($[-2^{31}$, $2^{31} - 1]$).
* The maximum length of a `String` literal is $2^{8} - 1$.
* Division/modulo by zero is considered "undefined behavior".
* Function names cannot be overwritten (e.g., it is not possible to declare both `void f()` and `string f` in the same program).
